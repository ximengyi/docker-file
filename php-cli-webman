# 使用 PHP 8.1 版本的官方 CLI 镜像作为基础镜像
FROM php:8.1-cli

# 安装系统依赖
RUN apt-get update && apt-get install -y \
    librdkafka-dev \
    libzip-dev \
    libevent-dev \
    && rm -r /var/lib/apt/lists/*

# 安装 Kafka 扩展
RUN pecl install rdkafka && docker-php-ext-enable rdkafka

# 安装 Redis 扩展
RUN pecl install redis && docker-php-ext-enable redis

# 安装 Zip 扩展
RUN docker-php-ext-install zip

# 安装 libevent 扩展
RUN pecl install event && docker-php-ext-enable event

# 安装 MongoDB 扩展
RUN pecl install mongodb && docker-php-ext-enable mongodb

# 清理安装过程中的临时文件
RUN apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

# 设置工作目录
WORKDIR /var/www/html

# 复制你的 PHP 代码到容器中
COPY . /var/www/html

# 启动 PHP-CLI
CMD ["php", "-S", "0.0.0.0:80"]
